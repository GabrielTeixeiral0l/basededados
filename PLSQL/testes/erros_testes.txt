========================================================================
INICIANDO SUITE DE TESTES DO PROJETO BD2 (INTEGRIDADE TOTAL)
========================================================================
[01/25] Executando Testes Unitários Integrados...
=== INICIANDO TESTES (Sufixo: 40382) ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Presença atualizada para Presente.
=== TESTES CONCLUÍDOS COM SUCESSO (COMMIT REALIZADO) ===
Inscrição Gerada: 11665

[02/25] Executando Validação e Formatação de Dados...
=== INICIANDO TESTES DE VALIDAÇÃO E FORMATAÇÃO ===
1. Testando Formatação Automática (InitCap, Lower, Upper)...
[OK] Formatação de Estudante (Nome/Email) correta.
[OK] Formatação de UC (Código Upper/Trim) correta.
2. Testando Validações de Dados (CC, Email, IBAN) individualmente...
[OK] CC Inválido bloqueado.
[OK] Log de CC detetado.
[OK] Email Inválido bloqueado.
[OK] Log de Email detetado.
[OK] IBAN Inválido bloqueado.
[OK] Log de IBAN detetado.
=== FIM DOS TESTES DE VALIDAÇÃO ===

[03/25] Executando Testes de Integridade da Tabela SALA...
=== INICIANDO TESTE TABELA SALA (DDLv3) ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Capacidade Inválida (Inserir -5)...
[OK] Capacidade corrigida para 1.
=== TESTE SALA: SUCESSO ===

[04/25] Executando Testes de Integridade da Tabela TURMA...
=== INICIANDO TESTE TABELA TURMA ===
1. Testando Inserção de Turma...
[OK] Turma criada com sucesso. ID: 11456
2. Testando Status Inválido ("X")...
[INFO] Turma com status inválido inserida (Sem trigger de validação ativo).
=== TESTE TURMA: SUCESSO ===

[05/25] Executando Testes de Integridade da Tabela AULA...
=== INICIANDO TESTE TABELA AULA ===
1. Testando Status Inválido (Inserir "9")...
[OK] Status corrigido para 0.
2. Testando Hora Fim Inválida (Fim < Início)...
[OK] Erro capturado na inserção de hora inválida (Se trigger for bloqueante).
3. Testando Conflito de Sala (Sobreposição)...
[OK] Conflito de sala bloqueado pelo sistema.
=== TESTE AULA: SUCESSO ===

[06/25] Executando Testes de Integridade da Tabela AVALIACAO...
=== INICIANDO TESTE TABELA AVALIACAO ===
1. Testando Status Inválido e Peso > 1...
[OK] Status corrigido.
[OK] Peso corrigido para 0.
2. Testando Data Entrega anterior ao inicio...
[OK] Data entrega ajustada.
3. Testando Tipo que nao requer entrega...
[OK] Data entrega forçada a NULL.
=== TESTE AVALIACAO: SUCESSO ===

[07/25] Executando Testes de Integridade da Tabela CURSO...
=== INICIANDO TESTE TABELA CURSO ===
1. Testando Status Inválido (Inserir "A")...
[OK] Status corrigido para 0.
2. Testando Duracao Inválida (Inserir 0)...
[OK] Duracao corrigida para 1.
3. Testando ECTS Inválidos (Inserir -10)...
[OK] ECTS corrigidos para 0.
=== TESTE CURSO: SUCESSO ===

[08/25] Executando Testes de Integridade da Tabela DOCENTE...
=== INICIANDO TESTE TABELA DOCENTE (DDLv3) ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido.
1.1. Testando Data Contratacao Futura...
[OK] Data futura bloqueada.
2. Testando Insercao de NIF Inválido (Letras)...
[OK] NIF invalido bloqueado.
=== TESTE DOCENTE: SUCESSO ===

[09/25] Executando Testes de Integridade da Tabela ESTUDANTE...
=== INICIANDO TESTE TABELA ESTUDANTE (DDLv3) ===
1. Testando Status Inválido (Inserir "9")...
[OK] Status corrigido.
2. Testando Idade Inválida (17 anos)...
[OK] Idade inválida bloqueada.
3. Testando Telemóvel Inválido (Letras)...
[OK] Telemovel invalido bloqueado.
=== TESTE ESTUDANTE: SUCESSO ===

[10/25] Executando Testes de Integridade da Tabela ENTREGA...
=== INICIANDO TESTE TABELA ENTREGA ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Entrega Fora do Prazo (Hoje > Prazo -5 dias)...
[OK] Insercao realizada. Verificar LOG para ALERTA de "Entrega FORA DO PRAZO".
3. Testando Entrega Antes do Inicio (-15 dias < Inicio -10 dias)...
[OK] Insercao realizada. Verificar LOG para ALERTA de "Entrega efetuada ANTES".
4. Testando Entrega em Avaliação que não requer ficheiros...
[OK] Insercao realizada. Verificar LOG para ALERTA de "nao requer entrega".
=== TESTE ENTREGA: SUCESSO (ROLLBACK EXECUTADO) ===

[11/25] Executando Testes de Integridade da Tabela ESTUDANTE_ENTREGA...
=== INICIANDO TESTE TABELA ESTUDANTE_ENTREGA (DDLv3) ===
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
1. Testando Inscrição de Outra Turma...
[OK] Inconsistencia bloqueada.
=== TESTE ESTUDANTE_ENTREGA: SUCESSO (ROLLBACK EXECUTADO) ===

[12/25] Executando Testes Funcionais Extra (Multas, Logs)...
=== INICIANDO TESTES FUNCIONAIS EXTRA (Sufixo: 40382) ===
Valor Total: 6000, Parcelas: 1
Plano gerado com sucesso: 1 parcelas.
1. Testando Multa por Atraso...
[OK] Multa aplicada. Original: 6000, Final: 6600
2. Testando Limites de Nota (0-20)...
[OK] Nota invalida bloqueada.
[OK] Log de erro encontrado.
3. Testando Flag de Auditoria (v_audit_enabled)...
[OK] Flag v_audit_enabled = FALSE respeitada.
[OK] Erro crítico gravado mesmo com auditoria desativada.
=== FIM DOS TESTES FUNCIONAIS EXTRA ===

[13/25] Executando Lógica de Negócio (Médias e Pagamentos)...
[14/25] Executando Testes Avançados (NIF, Conflitos)...
==========================================================
EXECUCAO DO BLOCO 13: TESTES AVANCADOS (Versao DDLv3)
==========================================================
Iniciando validacao de integridade...
[OK] NIF invalido bloqueado pelo sistema.
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Plano financeiro de 10 parcelas gerado automaticamente.
3. [OK] Soft-delete testado.
=== BLOCO 13 CONCLUIDO ===

[15/25] Executando Testes de Limites de ECTS...
=== TESTANDO LIMITES DE ECTS ===
Estudante criado ID: 11505
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
-> Criando UC Cadeira_A com 30 ECTS...
[INFO] Inscrição realizada com sucesso. Total Acumulado: 30
-> Criando UC Cadeira_B com 25 ECTS...
[INFO] Inscrição realizada com sucesso. Total Acumulado: 55
Tentando inscrever +10 ECTS (Total seria 65)...
-> Criando UC Cadeira_C com 10 ECTS...
[OK] Inscrição bloqueada pelo sistema (Limite de ECTS): User-Defined Exception
=== TESTE DE LIMITES: SUCESSO (Alerta detetado no LOG) ===

[16/25] Executando Testes de Regras de Avaliação (Hierarquia e Entregas)...
=== INICIANDO TESTES DE REGRAS DE AVALIAÇÃO ===
--- Teste 1: Validacao de Grupo (Ignorado - Sem coluna de grupo na tabela Avaliacao) ---
--- Teste 2: Tentar criar sub-avaliação onde pai não permite ---
[OK] Sub-avaliacao bloqueada como esperado.
[OK] Regra detectada no log via ERRO.
--- Teste 3: Tentar entregar ficheiro onde não é requerido ---
[OK] Regra detectada no log via ALERTA.
=== TESTES DE REGRAS CONCLUÍDOS ===

[17/25] Executando Regras de Max_Alunos e Grupos...
=== INICIANDO TESTE: REGRAS DE GRUPOS E LIMITES ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.

[18/25] Executando Teste de Segurança de Logs (Imutabilidade)...
=== INICIANDO TESTE DE SEGURANÇA DE LOGS ===
[OK] Insert no LOG permitido. ID: 79386
[OK] UPDATE bloqueado por imutabilidade.
[OK] DELETE bloqueado por imutabilidade.
=== TESTE DE SEGURANÇA CONCLUÍDO ===

[19/25] Validando Vistas e Relatórios...
=== INICIANDO TESTE DE VISTAS (Sufixo: 8661) ===
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
RELATORIO DE ASSIDUIDADE (Esperado 50% Faltas):
ALUNO: Erika Pinto-Abreu | FALTAS: 50%
CONSULTANDO PAUTA:
ALUNO: Erika Pinto-Abreu | RESULTADO: REPROVADO
TESTANDO RESTANTES VISTAS (SMOKE TEST)...
[OK] VW_FINANCEIRO_CURSOS: 153 registos.
[OK] VW_ESTATISTICA_VAGAS: 155 registos.

[20/25] Executando Testes de Integridade da Tabela FICHEIRO_ENTREGA...
=== INICIANDO TESTE TABELA FICHEIRO_ENTREGA ===
1. Testando Status Inválido (Inserir "A")...
[OK] Status corrigido para 0.
2. Testando Tamanho Zero (Limite Inferior)...
[OK] Ficheiro com tamanho 0 bloqueado.
3. Testando Tamanho Excessivo (10485761 bytes)...
[OK] Ficheiro gigante bloqueado.
4. Testando Inserção Válida...
[OK] Ficheiro válido inserido com sucesso.
=== TESTE FICHEIRO_ENTREGA: SUCESSO ===

[21/25] Executando Testes de Integridade da Tabela FICHEIRO_RECURSO...
=== INICIANDO TESTE TABELA FICHEIRO_RECURSO ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Ficheiro Vazio (NULL/Empty)...
[OK] Ficheiro vazio bloqueado pelo trigger.
3. Testando Inserção Válida...
[OK] Ficheiro de recurso inserido com sucesso.
=== TESTE FICHEIRO_RECURSO: SUCESSO ===

[22/25] Executando Testes de Regras Académicas de INSCRICAO...
=== INICIANDO TESTE DE REGRAS DE INSCRICAO (18d) ===
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Inscricao valida realizada.
[OK] Bloqueou duplicado corretamente: User-Defined Exception
=== FIM DOS TESTES DE INSCRICAO (ROLLBACK) ===

[23/25] Executando Testes de Regras da Tabela MATRICULA...
=== INICIANDO TESTES DA TABELA MATRICULA (18e) ===
>> 2.1 Testando Limites de Parcelas...
[OK] Bloqueou parcelas invalidas.
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Matricula valida inserida.
>> 2.3 Testando Calculo de Media Ponderada...
DIAGNOSTICO: Pontos=420 ECTS=30
[OK] Media ponderada calculada: 14

[24/25] Executando Testes de Validação de NOTA (Status, Turma)...
=== INICIANDO TESTE: VALIDAÇÃO DE NOTA (Turma e Status) ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
>> Teste 1: Inserir nota valida (Mesma Turma)...
[OK] Nota inserida com sucesso.
>> Teste 2: Inserir nota cruzada (Avaliacao de outra turma)...
[FALHA] Erro inesperado: User-Defined Exception
>> Teste 3: Validacao de Status Inválido...
[OK] Status "X" corrigido para "0".
=== TESTE CONCLUIDO (ROLLBACK) ===
[OK] Todas as validacoes de NOTA (status e turma) passaram.

[25/25] Executando Teste Integrado (Notas -> Media Geral)...
=== INICIANDO TESTE INTEGRADO: NOTAS -> MÉDIA GERAL ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
>> Notas parciais lancadas: 18 (UC1) e 12 (UC2).
>> Pautas fechadas. Notas Finais atualizadas.
----------------------------------------
Media Calculada pelo Sistema: 14
Media Esperada: 14
[OK] SUCESSO: A media foi calculada corretamente e propagada para a matricula.
=== FIM DO TESTE INTEGRADO (ROLLBACK) ===

[FINAL] Gerando Dados de Demonstração Permanentes...
=== GERANDO DADOS DE DEMONSTRAÇÃO (Cenário Realista) ===
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Dados gerados com sucesso.
Turma criada: 11473
Consulte a vista: SELECT * FROM VW_ALERTA_ASSIDUIDADE WHERE turma_id = 11473

========================================================================
TODOS OS TESTES FORAM EXECUTADOS COM SUCESSO.
========================================================================
