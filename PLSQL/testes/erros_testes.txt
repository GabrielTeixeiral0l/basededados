========================================================================
INICIANDO SUITE DE TESTES DO PROJETO BD2 (V3 - INTEGRIDADE TOTAL)
========================================================================
[1/12] Executando Testes Unitários Integrados...
=== INICIANDO TESTES (Sufixo: 80965) ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Presença atualizada para Presente.
=== TESTES CONCLUÍDOS COM SUCESSO (COMMIT REALIZADO) ===
Inscrição Gerada: 11199

[2/12] Executando Validação e Formatação de Dados...
=== INICIANDO TESTES DE VALIDAÇÃO E FORMATAÇÃO ===
1. Testando Formatação Automática (InitCap, Lower, Upper)...
[OK] Formatação de Estudante (Nome/Email) correta.
[OK] Formatação de UC (Código Upper/Trim) correta.
2. Testando Validações de Dados (CC, Email, IBAN) individualmente...
[OK] CC Inválido bloqueado.
[OK] Log de CC detetado.
[OK] Email Inválido bloqueado.
[OK] Log de Email detetado.
[OK] IBAN Inválido bloqueado.
[OK] Log de IBAN detetado.
=== FIM DOS TESTES DE VALIDAÇÃO ===

[3/13] Executando Testes de Integridade da Tabela SALA...
=== INICIANDO TESTE TABELA SALA (DDLv3) ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Capacidade Inválida (Inserir -5)...
[OK] Capacidade corrigida para 1.
=== TESTE SALA: SUCESSO ===

[3b/19] Executando Testes de Integridade da Tabela TURMA...
=== INICIANDO TESTE TABELA TURMA ===
1. Testando Inserção de Turma...
[OK] Turma criada com sucesso. ID: 10994
2. Testando Status Inválido ("X")...
[INFO] Turma com status inválido inserida (Sem trigger de validação ativo).
=== TESTE TURMA: SUCESSO ===

[4/14] Executando Testes de Integridade da Tabela AULA...
=== INICIANDO TESTE TABELA AULA ===
1. Testando Status Inválido (Inserir "9")...
[OK] Status corrigido para 0.
2. Testando Hora Fim Inválida (Fim < Início)...
[OK] Hora de fim ajustada para ser posterior ao início: 11:00
3. Testando Conflito de Sala (Sobreposição)...
[OK] Conflito de sala bloqueado pelo sistema.
=== TESTE AULA: SUCESSO ===

[5/15] Executando Testes de Integridade da Tabela AVALIACAO...
=== INICIANDO TESTE TABELA AVALIACAO ===
1. Testando Status Inválido e Peso > 1...
[OK] Status corrigido.
[OK] Peso corrigido para 0.
2. Testando Data Entrega anterior ao inicio...
[OK] Data entrega ajustada.
3. Testando Tipo que nao requer entrega...
[OK] Data entrega forçada a NULL.
=== TESTE AVALIACAO: SUCESSO ===

[6/16] Executando Testes de Integridade da Tabela CURSO...
=== INICIANDO TESTE TABELA CURSO ===
1. Testando Status Inválido (Inserir "A")...
[OK] Status corrigido para 0.
2. Testando Duracao Inválida (Inserir 0)...
[OK] Duracao corrigida para 1.
3. Testando ECTS Inválidos (Inserir -10)...
[OK] ECTS corrigidos para 0.
=== TESTE CURSO: SUCESSO ===

[7/17] Executando Testes de Integridade da Tabela DOCENTE...
=== INICIANDO TESTE TABELA DOCENTE (DDLv3) ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido.
1.1. Testando Data Contratacao Futura...
[OK] Data futura bloqueada.
2. Testando Insercao de NIF Inválido (Letras)...
[OK] NIF invalido bloqueado.
=== TESTE DOCENTE: SUCESSO ===

[8/18] Executando Testes de Integridade da Tabela ESTUDANTE...
=== INICIANDO TESTE TABELA ESTUDANTE (DDLv3) ===
1. Testando Status Inválido (Inserir "9")...
[OK] Status corrigido.
2. Testando Idade Inválida (17 anos)...
[OK] Idade inválida bloqueada.
3. Testando Telemóvel Inválido (Letras)...
[OK] Telemovel invalido bloqueado.
=== TESTE ESTUDANTE: SUCESSO ===

[9/19] Executando Testes de Integridade da Tabela ENTREGA...
=== INICIANDO TESTE TABELA ENTREGA ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Entrega Fora do Prazo (Hoje > Prazo -5 dias)...
[OK] Insercao realizada. Verificar LOG para ALERTA de "Entrega FORA DO PRAZO".
3. Testando Entrega Antes do Inicio (-15 dias < Inicio -10 dias)...
[OK] Insercao realizada. Verificar LOG para ALERTA de "Entrega efetuada ANTES".
4. Testando Entrega em Avaliação que não requer ficheiros...
[OK] Insercao realizada. Verificar LOG para ALERTA de "nao requer entrega".
=== TESTE ENTREGA: SUCESSO (ROLLBACK EXECUTADO) ===

[10/19] Executando Testes de Integridade da Tabela ESTUDANTE_ENTREGA...
=== INICIANDO TESTE TABELA ESTUDANTE_ENTREGA (DDLv3) ===
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
1. Testando Inscrição de Outra Turma...
[OK] Inconsistencia bloqueada.
2. Testando Duplicação de Grupo...
[OK] Duplicacao bloqueada.
=== TESTE ESTUDANTE_ENTREGA: SUCESSO (ROLLBACK EXECUTADO) ===

[11/19] Executando Testes Funcionais Extra (Multas, Logs)...
=== INICIANDO TESTES FUNCIONAIS EXTRA (Sufixo: 80966) ===
Valor Total: 6000, Parcelas: 1
Plano gerado com sucesso: 1 parcelas.
1. Testando Multa por Atraso...
[OK] Multa aplicada. Original: 6000, Final: 6600
2. Testando Limites de Nota (0-20)...
[OK] Nota invalida bloqueada.
[OK] Log de erro encontrado.
3. Testando Flag de Auditoria (v_audit_enabled)...
[OK] Flag v_audit_enabled = FALSE respeitada.
[OK] Erro crítico gravado mesmo com auditoria desativada.
=== FIM DOS TESTES FUNCIONAIS EXTRA ===

[12/19] Executando Lógica de Negócio (Médias e Pagamentos)...
=== INICIANDO TESTES DE LÓGICA DE NEGÓCIO ===
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
1. Testando Agregação de Notas (Exemplos Variados)...
[OK] Exemplo 1 (Pai A): Nota 16 (Esperado 16)
[OK] Exemplo 2 (Pai B): Nota 15 (Esperado 15)
2. Testando Liquidação de Parcela...
[OK] Parcela liquidada com sucesso (Estado mudou para 1).
=== TESTES DE LÓGICA FINALIZADOS ===

[13/19] Executando Testes Avançados (NIF, Conflitos)...
==========================================================
EXECUCAO DO BLOCO 13: TESTES AVANCADOS (Versao DDLv3)
==========================================================
Iniciando validacao de integridade...
[OK] NIF invalido bloqueado pelo sistema.
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Plano financeiro de 10 parcelas gerado automaticamente.
3. [OK] Soft-delete testado.
=== BLOCO 13 CONCLUIDO ===

[14/19] Executando Testes de Limites de ECTS...
=== TESTANDO LIMITES DE ECTS ===
Estudante criado ID: 11076
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
-> Criando UC Cadeira_A com 30 ECTS...
[INFO] Inscrição realizada com sucesso. Total Acumulado: 30
-> Criando UC Cadeira_B com 25 ECTS...
[INFO] Inscrição realizada com sucesso. Total Acumulado: 55
Tentando inscrever +10 ECTS (Total seria 65)...
-> Criando UC Cadeira_C com 10 ECTS...
[OK] Inscrição bloqueada pelo sistema (Limite de ECTS): User-Defined Exception
=== TESTE DE LIMITES: SUCESSO (Alerta detetado no LOG) ===

[15/19] Executando Testes de Regras de Avaliação (Hierarquia e Entregas)...
=== INICIANDO TESTES DE REGRAS DE AVALIAÇÃO ===
--- Teste 1: Validacao de Grupo (Ignorado - Sem coluna de grupo na tabela Avaliacao) ---
--- Teste 2: Tentar criar sub-avaliação onde pai não permite ---
[OK] Sub-avaliacao bloqueada como esperado.
[OK] Regra detectada no log via ERRO.
--- Teste 3: Tentar entregar ficheiro onde não é requerido ---
[OK] Regra detectada no log via ALERTA.
=== TESTES DE REGRAS CONCLUÍDOS ===

[16/19] Executando Regras de Max_Alunos e Grupos...
=== INICIANDO TESTE: REGRAS DE GRUPOS E LIMITES ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Cenario 1: Inserindo Avaliacao Individual com max_alunos = 10...
[SUCESSO] O Trigger corrigiu max_alunos para 1.
Cenario 2: Testando limite de 2 alunos numa entrega...
[OK] Terceiro aluno bloqueado pelo trigger.
[SUCESSO] O sistema registrou o erro no LOG.
=== FIM DOS TESTES DE GRUPOS ===

[17/19] Executando Teste de Segurança de Logs (Imutabilidade)...
=== INICIANDO TESTE DE SEGURANÇA DE LOGS ===
[OK] Insert no LOG permitido. ID: 58097
[OK] UPDATE bloqueado por imutabilidade.
[OK] DELETE bloqueado por imutabilidade.
=== TESTE DE SEGURANÇA CONCLUÍDO ===

[18/19] Validando Vistas e Relatórios...
=== INICIANDO TESTE DE VISTAS ===
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
RELATORIO DE ASSIDUIDADE (Esperado Aluno com 50% Faltas):
ALUNO: Erika Pinto-Abreu | FALTAS: 50%
CONSULTANDO PAUTA DA TURMA:
ALUNO: Erika Pinto-Abreu | RESULTADO: REPROVADO
TESTANDO RESTANTES VISTAS (SMOKE TEST)...
[OK] VW_FINANCEIRO_CURSOS: 46 registos.
[OK] VW_ESTATISTICA_VAGAS: 48 registos.
[OK] VW_OCUPACAO_SALAS_HOJE: 15 registos.
[OK] VW_PERFIL_ACADEMICO_ALUNO: 902 registos.

[18b/19] Executando Testes de Integridade da Tabela FICHEIRO_ENTREGA...
=== INICIANDO TESTE TABELA FICHEIRO_ENTREGA ===
1. Testando Status Inválido (Inserir "A")...
[OK] Status corrigido para 0.
2. Testando Tamanho Zero (Limite Inferior)...
[OK] Ficheiro com tamanho 0 bloqueado.
3. Testando Tamanho Excessivo (10485761 bytes)...
[OK] Ficheiro gigante bloqueado.
4. Testando Inserção Válida...
[OK] Ficheiro válido inserido com sucesso.
=== TESTE FICHEIRO_ENTREGA: SUCESSO ===

[18c/19] Executando Testes de Integridade da Tabela FICHEIRO_RECURSO...
=== INICIANDO TESTE TABELA FICHEIRO_RECURSO ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Ficheiro Vazio (NULL/Empty)...
[OK] Ficheiro vazio bloqueado pelo trigger.
3. Testando Inserção Válida...
[OK] Ficheiro de recurso inserido com sucesso.
=== TESTE FICHEIRO_RECURSO: SUCESSO ===

[19/19] Gerando Dados de Demonstração Finais (Cenário Realista)...
=== GERANDO DADOS DE DEMONSTRAÇÃO (Cenário Realista) ===
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Dados gerados com sucesso.
Turma criada: 11003
Consulte a vista: SELECT * FROM VW_ALERTA_ASSIDUIDADE WHERE turma_id = 11003

========================================================================
TODOS OS TESTES FORAM EXECUTADOS.
VERIFIQUE OS LOGS ACIMA PARA CONFIRMAR OS RESULTADOS [OK].
========================================================================
