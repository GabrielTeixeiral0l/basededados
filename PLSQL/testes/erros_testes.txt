========================================================================
INICIANDO SUITE DE TESTES DO PROJETO BD2 (INTEGRIDADE TOTAL)
========================================================================
[01/25] Executando Testes Unitários Integrados...
=== INICIANDO TESTES INTEGRADOS (Sufixo: 7294) ===
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Plano financeiro (10 parcelas) gerado automaticamente.
!!! ERRO NOS TESTES INTEGRADOS !!!
Erro: ORA-04091: table OPR_PROJETO.INSCRICAO is mutating, trigger/function may not see it
ORA-06512: at "OPR_PROJETO.TRG_VAL_PRESENCA", line 38
ORA-04088: error during execution of trigger 'OPR_PROJETO.TRG_VAL_PRESENCA'
ORA-06512: at "OPR_PROJETO.TRG_AUTO_PRESENCA_INS", line 18
ORA-04088: error during execution of trigger 'OPR_PROJETO.TRG_AUTO_PRESENCA_INS'

[02/25] Executando Validação e Formatação de Dados...
=== INICIANDO TESTES DE VALIDAÇÃO E FORMATAÇÃO ===
1. Testando Formatação Automática (InitCap, Lower, Upper)...
[OK] Formatação de Estudante (Nome/Email) correta.
[OK] Formatação de UC (Código Upper/Trim) correta.
2. Testando Validações de Dados (CC, Email, IBAN) individualmente...
[OK] CC Inválido bloqueado.
[OK] Log de CC detetado.
[OK] Email Inválido bloqueado.
[OK] Log de Email detetado.
[OK] IBAN Inválido bloqueado.
[OK] Log de IBAN detetado.
=== FIM DOS TESTES DE VALIDAÇÃO ===

[03/25] Executando Testes de Integridade da Tabela SALA...
=== INICIANDO TESTE TABELA SALA (DDLv3) ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Capacidade Inválida (Inserir -5)...
[OK] Capacidade corrigida para 1.
=== TESTE SALA: SUCESSO ===

[04/25] Executando Testes de Integridade da Tabela TURMA...
=== INICIANDO TESTE TABELA TURMA ===
1. Testando Inserção de Turma...
[OK] Turma criada com sucesso. ID: 12086
2. Testando Status Inválido ("X")...
[INFO] Turma com status inválido inserida (Sem trigger de validação ativo).
=== TESTE TURMA: SUCESSO ===

[05/25] Executando Testes de Integridade da Tabela AULA...
=== INICIANDO TESTE TABELA AULA ===
1. Testando Status Inválido (Inserir "9")...
[OK] Status corrigido para 0.
2. Testando Hora Fim Inválida (Fim < Início)...
[OK] Erro capturado na inserção de hora inválida (Se trigger for bloqueante).
3. Testando Conflito de Sala (Sobreposição)...
[OK] Conflito de sala bloqueado pelo sistema.
=== TESTE AULA: SUCESSO ===

[06/25] Executando Testes de Integridade da Tabela AVALIACAO...
=== INICIANDO TESTE TABELA AVALIACAO ===
1. Testando Status Inválido e Peso > 1...
[OK] Status corrigido.
[OK] Peso corrigido para 0.
2. Testando Data Entrega anterior ao inicio...
[OK] Data entrega ajustada.
3. Testando Tipo que nao requer entrega...
[OK] Data entrega forçada a NULL.
=== TESTE AVALIACAO: SUCESSO ===

[07/25] Executando Testes de Integridade da Tabela CURSO...
=== INICIANDO TESTE TABELA CURSO ===
1. Testando Status Inválido (Inserir "A")...
[OK] Status corrigido para 0.
2. Testando Duracao Inválida (Inserir 0)...
[OK] Duracao corrigida para 1.
3. Testando ECTS Inválidos (Inserir -10)...
[OK] ECTS corrigidos para 0.
=== TESTE CURSO: SUCESSO ===

[08/25] Executando Testes de Integridade da Tabela DOCENTE...
=== INICIANDO TESTE TABELA DOCENTE (DDLv3) ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido.
1.1. Testando Data Contratacao Futura...
[OK] Data futura bloqueada.
2. Testando Insercao de NIF Inválido (Letras)...
[OK] NIF invalido bloqueado.
=== TESTE DOCENTE: SUCESSO ===

[09/25] Executando Testes de Integridade da Tabela ESTUDANTE...
=== INICIANDO TESTE TABELA ESTUDANTE (DDLv3) ===
1. Testando Status Inválido (Inserir "9")...
[OK] Status corrigido.
2. Testando Idade Inválida (17 anos)...
[OK] Idade inválida bloqueada.
3. Testando Telemóvel Inválido (Letras)...
[OK] Telemovel invalido bloqueado.
=== TESTE ESTUDANTE: SUCESSO ===

[10/25] Executando Testes de Integridade da Tabela ENTREGA...
=== INICIANDO TESTE TABELA ENTREGA ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Entrega Fora do Prazo (Hoje > Prazo -5 dias)...
[OK] Insercao realizada. Verificar LOG para ALERTA de "Entrega FORA DO PRAZO".
3. Testando Entrega Antes do Inicio (-15 dias < Inicio -10 dias)...
[OK] Insercao realizada. Verificar LOG para ALERTA de "Entrega efetuada ANTES".
4. Testando Entrega em Avaliação que não requer ficheiros...
[OK] Insercao realizada. Verificar LOG para ALERTA de "nao requer entrega".
=== TESTE ENTREGA: SUCESSO (ROLLBACK EXECUTADO) ===

[11/25] Executando Testes de Integridade da Tabela ESTUDANTE_ENTREGA...
=== INICIANDO TESTE TABELA ESTUDANTE_ENTREGA (DDLv3) ===
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
1. Testando Inscrição de Outra Turma...
[OK] Inconsistencia bloqueada.
=== TESTE ESTUDANTE_ENTREGA: SUCESSO (ROLLBACK EXECUTADO) ===

[12/25] Executando Testes Funcionais Extra (Multas, Logs)...
=== INICIANDO TESTES FUNCIONAIS EXTRA (Sufixo: 55225) ===
Valor Total: 6000, Parcelas: 1
Plano gerado com sucesso: 1 parcelas.
1. Testando Multa por Atraso...
[OK] Multa aplicada. Original: 6000, Final: 6600
2. Testando Limites de Nota (0-20)...
[OK] Nota invalida bloqueada.
[OK] Log de erro encontrado.
3. Testando Flag de Auditoria (v_audit_enabled)...
[OK] Flag v_audit_enabled = FALSE respeitada.
[OK] Erro crítico gravado mesmo com auditoria desativada.
=== FIM DOS TESTES FUNCIONAIS EXTRA ===

[13/25] Executando Lógica de Negócio (Médias e Pagamentos)...
[14/25] Executando Testes Avançados (NIF, Conflitos)...
==========================================================
EXECUCAO DO BLOCO 13: TESTES AVANCADOS (Versao DDLv3)
==========================================================
Iniciando validacao de integridade...
[OK] NIF invalido bloqueado pelo sistema.
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Plano financeiro de 10 parcelas gerado automaticamente.
3. [OK] Soft-delete testado.
=== BLOCO 13 CONCLUIDO ===

[15/25] Executando Testes de Limites de ECTS...
=== TESTANDO LIMITES DE ECTS ===
Valor Total: 8000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
-> Inscricao OK (30 ECTS).
-> Bloqueio esperado: User-Defined Exception
=== TESTE DE LIMITES: SUCESSO ===

[16/25] Executando Testes de Regras de Avaliação (Hierarquia e Entregas)...
=== INICIANDO TESTES DE REGRAS DE AVALIAÇÃO ===
--- Teste 1: Validacao de Grupo (Ignorado - Sem coluna de grupo na tabela Avaliacao) ---
--- Teste 2: Tentar criar sub-avaliação onde pai não permite ---
[OK] Sub-avaliacao bloqueada como esperado.
[OK] Regra detectada no log via ERRO.
--- Teste 3: Tentar entregar ficheiro onde não é requerido ---
[OK] Regra detectada no log via ALERTA.
=== TESTES DE REGRAS CONCLUÍDOS ===

[17/25] Executando Regras de Max_Alunos e Grupos...
=== INICIANDO TESTE: REGRAS DE GRUPOS E LIMITES ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.

[18/25] Executando Teste de Segurança de Logs (Imutabilidade)...
=== INICIANDO TESTE DE SEGURANÇA DE LOGS ===
[OK] Insert no LOG permitido. ID: 94557
[OK] UPDATE bloqueado por imutabilidade.
[OK] DELETE bloqueado por imutabilidade.
=== TESTE DE SEGURANÇA CONCLUÍDO ===

[19/25] Validando Vistas e Relatórios...
=== INICIANDO TESTE DE VISTAS (Sufixo: 9967) ===
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
ERRO NOS TESTES DE VISTAS: ORA-04091: table OPR_PROJETO.INSCRICAO is mutating, trigger/function may not see it
ORA-06512: at "OPR_PROJETO.TRG_VAL_PRESENCA", line 38
ORA-04088: error during execution of trigger 'OPR_PROJETO.TRG_VAL_PRESENCA'
ORA-06512: at "OPR_PROJETO.TRG_AUTO_PRESENCA_INS", line 18
ORA-04088: error during execution of trigger 'OPR_PROJETO.TRG_AUTO_PRESENCA_INS'

[20/25] Executando Testes de Integridade da Tabela FICHEIRO_ENTREGA...
=== INICIANDO TESTE TABELA FICHEIRO_ENTREGA ===
1. Testando Status Inválido (Inserir "A")...
[OK] Status corrigido para 0.
2. Testando Tamanho Zero (Limite Inferior)...
[OK] Ficheiro com tamanho 0 bloqueado.
3. Testando Tamanho Excessivo (10485761 bytes)...
[OK] Ficheiro gigante bloqueado.
4. Testando Inserção Válida...
[OK] Ficheiro válido inserido com sucesso.
=== TESTE FICHEIRO_ENTREGA: SUCESSO ===

[21/25] Executando Testes de Integridade da Tabela FICHEIRO_RECURSO...
=== INICIANDO TESTE TABELA FICHEIRO_RECURSO ===
1. Testando Status Inválido (Inserir "X")...
[OK] Status corrigido para 0.
2. Testando Ficheiro Vazio (NULL/Empty)...
[OK] Ficheiro vazio bloqueado pelo trigger.
3. Testando Inserção Válida...
[OK] Ficheiro de recurso inserido com sucesso.
=== TESTE FICHEIRO_RECURSO: SUCESSO ===

[22/25] Executando Testes de Regras Académicas de INSCRICAO...
=== INICIANDO TESTE DE REGRAS DE INSCRICAO (18d) ===
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Inscricao valida realizada.
[OK] Bloqueou duplicado corretamente: User-Defined Exception
=== FIM DOS TESTES DE INSCRICAO (ROLLBACK) ===

[23/25] Executando Testes de Regras da Tabela MATRICULA...
=== INICIANDO TESTES DA TABELA MATRICULA (18e) ===
>> 2.1 Testando Limites de Parcelas...
[OK] Bloqueou parcelas invalidas.
Valor Total: 6000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[OK] Matricula valida inserida.
>> 2.3 Testando Calculo de Media Ponderada...
DIAGNOSTICO: Pontos=420 ECTS=30
[OK] Media ponderada calculada: 14

[24/26] Executando Testes de Validação de NOTA (Status, Turma)...
=== INICIANDO TESTE: VALIDAÇÃO DE NOTA (Turma e Status) ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
>> Teste 1: Inserir nota valida (Mesma Turma)...
[OK] Nota inserida com sucesso.
>> Teste 2: Inserir nota cruzada (Avaliacao de outra turma)...
[OK] Bloqueio de turma cruzada funcionou (Excecao capturada).
>> Teste 3: Validacao de Status Inválido...
[OK] Status "X" corrigido para "0".
=== TESTE CONCLUIDO (ROLLBACK) ===
[OK] Todas as validacoes de NOTA (status e turma) passaram.

[25/26] Executando Teste Integrado (Notas -> Media Geral)...
=== INICIANDO TESTE INTEGRADO: NOTAS -> MÉDIA GERAL ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
>> Notas parciais lancadas: 18 (UC1) e 12 (UC2).
>> Pautas fechadas. Notas Finais atualizadas.
----------------------------------------
Media Calculada pelo Sistema: 14
Media Esperada: 14
[OK] SUCESSO: A media foi calculada corretamente e propagada para a matricula.
=== FIM DO TESTE INTEGRADO (ROLLBACK) ===

[26/27] Executando Testes de Integridade da Tabela PARCELA_PROPINA...
=== INICIANDO TESTE: PARCELA_PROPINA ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
[SETUP] Dados base criados. Matricula ID: 12029
>> Teste 1: Valor Negativo (Bloqueio)...
[OK] Bloqueou valor negativo.
>> Teste 2: Data Vencimento Passada no INSERT (Bloqueio)...
[OK] Bloqueou data passada no INSERT.
>> Teste 3: Data Vencimento Passada no UPDATE (Permite)...
[OK] Permitiu data passada no UPDATE (necessario para testar multas).
>> Teste 4: Data Pagamento Automatica ao Pagar...
[OK] Data pagamento preenchida automaticamente.
=== TESTE PARCELA_PROPINA CONCLUIDO ===

[27/27] Executando Testes de Integridade da Tabela PRESENCA...
=== INICIANDO TESTE: PRESENÇA ===
Valor Total: 1000, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
!!! ERRO FATAL NO TESTE PRESENCA !!!
Erro: ORA-04091: table OPR_PROJETO.AULA is mutating, trigger/function may not see it
ORA-06512: at "OPR_PROJETO.TRG_VAL_PRESENCA", line 38
ORA-04088: error during execution of trigger 'OPR_PROJETO.TRG_VAL_PRESENCA'
ORA-06512: at "OPR_PROJETO.TRG_AUTO_PRESENCA_AULA", line 18
ORA-04088: error during execution of trigger 'OPR_PROJETO.TRG_AUTO_PRESENCA_AULA'

[FINAL] Gerando Dados de Demonstração Permanentes...
=== GERANDO DADOS DE DEMONSTRAÇÃO (Cenário Realista) ===
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Valor Total: 1500, Parcelas: 10
Plano gerado com sucesso: 10 parcelas.
Aviso: Aula 1 ignorada devido a erro de validação.
Aviso: Aula 2 ignorada devido a erro de validação.
Aviso: Aula 3 ignorada devido a erro de validação.
Aviso: Aula 4 ignorada devido a erro de validação.
Aviso: Aula 5 ignorada devido a erro de validação.
Aviso: Aula 6 ignorada devido a erro de validação.
Aviso: Aula 7 ignorada devido a erro de validação.
Aviso: Aula 8 ignorada devido a erro de validação.
Aviso: Aula 9 ignorada devido a erro de validação.
Aviso: Aula 10 ignorada devido a erro de validação.
Dados gerados com sucesso.
Turma criada: 12104
Consulte a vista: SELECT * FROM VW_ALERTA_ASSIDUIDADE WHERE turma_id = 12104

========================================================================
TODOS OS TESTES FORAM EXECUTADOS COM SUCESSO.
========================================================================
